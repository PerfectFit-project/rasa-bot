# Stories for relapse dialogs
version: "3.1"

stories:

# 1a: Trigger relapse dialog - smoking
- story: Relapse phase triggered smoke
  steps:
    - intent: relapse_dialog
    - action: action_set_slot_relapse_dialog
    - action: utter_relapse_intro_codeword
    - action: utter_relapse_intro_offer_help
    - action: utter_relapse_smoke_or_pa
    - action: smoke_or_pa_form
    - active_loop: smoke_or_pa_form
    - slot_was_set:
      - smoke_or_pa: 1
    - active_loop: null
    - action: utter_specify_smoke
    - action: crave_lapse_relapse_form
    - active_loop: crave_lapse_relapse_form
    - active_loop: null


# 1b: Trigger relapse dialog - PA
- story: Relapse phase triggered PA
  steps:
    - intent: relapse_dialog
    - action: action_set_slot_relapse_dialog
    - action: utter_relapse_intro_codeword
    - action: utter_relapse_intro_offer_help
    - action: utter_relapse_smoke_or_pa
    - action: smoke_or_pa_form
    - active_loop: smoke_or_pa_form
    - slot_was_set:
      - smoke_or_pa: 2
    - active_loop: null
    - checkpoint: pa_parent

## Stories for smoking
# 2a: Parent for Smoking - crave
- story: smoking parent crave
  steps:
  - checkpoint: smoke_parent
  - action: utter_specify_smoke
  - action: crave_lapse_relapse_form
  - active_loop: crave_lapse_relapse_form
  - active_loop: null
  - slot_was_set:
    - crave_lapse_relapse: 1
  - action: utter_smoke_crave_1
  - action: utter_smoke_crave_2
  - action: utter_smoke_crave_3
  - action: utter_smoke_crave_4
  - action: utter_smoke_crave_5
  - action: utter_smoke_crave_6
  - action: utter_smoke_crave_7
  - action: utter_smoke_crave_8
  - checkpoint: smoke_hrs

## 2b: Parent for Smoking - lapse
- story: smoking parent lapse
  steps:
  - checkpoint: smoke_parent
  - action: utter_specify_smoke
  - action: crave_lapse_relapse_form
  - active_loop: crave_lapse_relapse_form
  - active_loop: null
  - slot_was_set:
    - crave_lapse_relapse: 2
  - checkpoint: smoke_lapse

## 2c Parent for Smoking - relapse
- story: smoking parent relapse
  steps:
  - checkpoint: smoke_parent
  - action: utter_specify_smoke
  - action: crave_lapse_relapse_form
  - active_loop: crave_lapse_relapse_form
  - active_loop: null
  - slot_was_set:
    - crave_lapse_relapse: 3
  - checkpoint: smoke_relapse

## 3a smoking - HRS - EHBO
- story: smoke hrs  # TODO: store in database the number of times this story is executed (create issue)
  steps:
  - checkpoint: smoke_hrs
  - action: ehbo_me_self_form
  - active_loop: ehbo_me_self_form
  - slot_was_set:
    - ehbo_me_self: 1
  - active_loop: null
  - checkpoint: continue_with_relapse_dialog #open_fak

## 4a smoking - HRS - EHBO
- story: smoke hrs after fak
  steps:
  - checkpoint: continue_with_relapse_dialog
  - action: hrs_new_activity_form
  - active_loop: hrs_new_activity_form
  - slot_was_set:
    - hrs_new_activity_slot: 2
  - active_loop: null
  - checkpoint: smoke_hrs

## 4a smoking - HRS - EHBO - after ehbo
- story: smoke hrs after fak
  steps:
  - checkpoint: continue_with_relapse_dialog
  - action: hrs_new_activity_form
  - active_loop: hrs_new_activity_form
  - slot_was_set:
    - hrs_new_activity_slot: 1
  - active_loop: null
  - action: utter_hrs_reasons_1
  - action: utter_hrs_reasons_2
  - action: utter_hrs_reasons_3
  - action: utter_hrs_reasons_4
  - action: hrs_situation_form
  - active_loop: hrs_situation_form
  - active_loop: null
  - action: store_hrs_situation
  - action: utter_hrs_how_did_you_feel_1
  - action: hrs_feeling_form
  - active_loop: hrs_feeling_form
  - active_loop: null
  - action: store_hrs_feeling
  - action: utter_hrs_how_did_you_feel_2
  - action: utter_hrs_who_you_with
  - action: hrs_who_with_form
  - active_loop: hrs_who_with_form
  - active_loop: null
  - action: store_hrs_who_with
  - action: hrs_what_happened_form
  - active_loop: hrs_what_happened_form
  - active_loop: null
  - action: store_hrs_what_happened
  - action: utter_smoke_lapse_12
  - action: utter_hrs_look_back_1
  - action: utter_hrs_look_back_2
  - action: show_barchart_difficult_situations
  - action: hrs_like_feedback_form
  - active_loop: hrs_like_feedback_form
  - active_loop: null
  - action: utter_hrs_look_back_3
  - checkpoint: hrs_enough_motivation_checkpoint

- story: smoke hrs after fak end dialog
  steps:
  - checkpoint: hrs_enough_motivation_checkpoint
  - action: hrs_enough_motivation_form
  - active_loop: hrs_enough_motivation_form
  - slot_was_set:
      - hrs_enough_motivation_slot: 1
  - active_loop: null
  - action: utter_good_to_hear_1
  - action: utter_good_to_hear_2
  - action: action_end_dialog

- story: smoke hrs after fak no activity
  steps:
  - checkpoint: hrs_enough_motivation_checkpoint
  - action: hrs_enough_motivation_form
  - active_loop: hrs_enough_motivation_form
  - slot_was_set:
      - hrs_enough_motivation_slot: 2
  - active_loop: null
  - action: utter_bad_to_hear_1
  - action: utter_bad_to_hear_2
  - action: hrs_activity_form
  - active_loop: hrs_activity_form
  - slot_was_set:
      - hrs_activity_slot: 1
  - active_loop: null
  - checkpoint: smoke_hrs

- story: smoke hrs after fak activity
  steps:
  - checkpoint: hrs_enough_motivation_checkpoint
  - action: hrs_enough_motivation_form
  - active_loop: hrs_enough_motivation_form
  - slot_was_set:
      - hrs_enough_motivation_slot: 2
  - active_loop: null
  - action: utter_bad_to_hear_1
  - action: utter_bad_to_hear_2
  - action: hrs_activity_form
  - active_loop: hrs_activity_form
  - slot_was_set:
      - hrs_activity_slot: 2
  - active_loop: null
  - action: utter_hrs_call_help
  - action: action_end_dialog

# 3a smoking - HRS - system suggest activity
- story: smoke hrs
  steps:
  - checkpoint: smoke_hrs
  - action: ehbo_me_self_form
  - active_loop: ehbo_me_self_form
  - slot_was_set:
    - ehbo_me_self: 2
  - active_loop: null
  - action: show_first_coping_activity
#  - checkpoint: continue_with_relapse_dialog

## 3a smoking - HRS - self activity
- story: smoke hrs
  steps:
  - checkpoint: smoke_hrs
  - action: ehbo_me_self_form
  - active_loop: ehbo_me_self_form
  - slot_was_set:
    - ehbo_me_self: 3
  - active_loop: null
  - action: populate_coping_activities_list
  - action: hrs_choose_coping_activity_form
  - active_loop: hrs_choose_coping_activity_form
  - active_loop: null
  - action: show_chosen_coping_activity
  - checkpoint: continue_with_relapse_dialog


  ## 3b smoking - lapse
- story: smoke hrs  # TODO: store in database the number of times this story is executed (create issue)
  steps:
  - checkpoint: smoke_lapse
  - action: utter_smoke_lapse_1
  - action: type_and_number_smoke_form
  - active_loop: type_and_number_smoke_form
  - slot_was_set:
    - requested_slot: type_smoke  # TODO: store number in DB.
  - slot_was_set:
    - requested_slot: type_smoke_confirm  # TODO: maybe later substitue number for actual type
  - slot_was_set:
    - requested_slot: number_smoke
  - slot_was_set:
    - requested_slot: number_smoke_confirm
  - active_loop: null
  - action: utter_smoke_lapse_5
  - action: utter_smoke_lapse_6
  - action: utter_smoke_lapse_7
  - action: utter_smoke_lapse_8
  - action: utter_smoke_lapse_9
  - action: utter_smoke_lapse_10
  - action: what_doing_how_feel_smoke_form
  - active_loop: what_doing_how_feel_smoke_form
  - slot_was_set:
    - requested_slot: what_doing_smoke  # TODO: store in DB
  - slot_was_set:
    - requested_slot: how_feel_smoke   # TODO: store to DB
  - active_loop: null
  - action: utter_smoke_lapse_11
  - action: with_whom_event_smoke_form
  - active_loop: with_whom_event_smoke_form
  - slot_was_set:
    - requested_slot: with_whom_smoke   # TODO: store to DB
  - slot_was_set:
    - requested_slot: event_smoke  # TODO: store to DB
  - active_loop: null
  - action: utter_smoke_lapse_12
  - action: utter_smoke_lapse_13
  - action: utter_smoke_lapse_14
  - action: show_barchart_difficult_situations # TODO: send bar diagram moeilijke situaties
  - action: reflect_bar_chart_form
  - active_loop: reflect_bar_chart_form
  - slot_was_set:
    - requested_slot: reflect_bar_chart
  - active_loop: null
  - action: utter_smoke_lapse_15
  - action: utter_smoke_lapse_16
  - action: utter_smoke_lapse_17
  - action: utter_smoke_lapse_18
  - checkpoint: ehbo_me_self_lapse_checkpoint

- story: smoke lapse open ehbo
  steps:
  - checkpoint: ehbo_me_self_lapse_checkpoint
  - action: ehbo_me_self_lapse_form
  - active_loop: ehbo_me_self_lapse_form
  - slot_was_set:
    - ehbo_me_self_lapse: 1
  - active_loop: null
  - action: action_set_slot_relapse_dialog_lapse
  - checkpoint: open_fak

- story: smoke lapse system suggests activity
  steps:
  - checkpoint: ehbo_me_self_lapse_checkpoint
  - action: ehbo_me_self_lapse_form
  - active_loop: ehbo_me_self_lapse_form
  - slot_was_set:
    - ehbo_me_self_lapse: 2
  - active_loop: null
  - action: show_first_coping_activity
  - checkpoint: continue_relapse_dialog_smoke_lapse

- story: smoke lapse user chooses activity
  steps:
  - checkpoint: ehbo_me_self_lapse_checkpoint
  - action: ehbo_me_self_lapse_form
  - active_loop: ehbo_me_self_lapse_form
  - slot_was_set:
    - ehbo_me_self_lapse: 3
  - active_loop: null
  - action: utter_hrs_list_activities_intro
  - action: populate_coping_activities_list
  - action: hrs_choose_coping_activity_form
  - active_loop: hrs_choose_coping_activity_form
  - active_loop: null
  - action: show_chosen_coping_activity
  - checkpoint: continue_relapse_dialog_smoke_lapse

- story: smoke lapse user has motivation
  steps:
  - checkpoint: ehbo_me_self_lapse_checkpoint
  - action: ehbo_me_self_lapse_form
  - active_loop: ehbo_me_self_lapse_form
  - slot_was_set:
    - ehbo_me_self_lapse: 4
  - active_loop: null
  - action: utter_good_to_hear_1
  - action: utter_good_to_hear_2
  - action: utter_good_to_hear_3
  - action: action_end_dialog

- story: continue smoke lapse enough motivation
  steps:
  - checkpoint: continue_relapse_dialog_smoke_lapse
  - action: hrs_enough_motivation_form
  - active_loop: hrs_enough_motivation_form
  - slot_was_set:
    - hrs_enough_motivation_slot: 1
  - active_loop: null
  - action: utter_good_to_hear_1
  - action: utter_good_to_hear_2
  - action: utter_good_to_hear_3
  - action: action_end_dialog

- story: continue smoke lapse not enough motivation 1
  steps:
  - checkpoint: continue_relapse_dialog_smoke_lapse
  - action: hrs_enough_motivation_form
  - active_loop: hrs_enough_motivation_form
  - slot_was_set:
    - hrs_enough_motivation_slot: 2
  - active_loop: null
  - action: utter_bad_to_hear_1
  - action: utter_bad_to_hear_2
  - action: hrs_activity_form
  - active_loop: hrs_activity_form
  - slot_was_set:
      - hrs_activity_slot: 1
  - active_loop: null
  - checkpoint: ehbo_me_self_lapse_checkpoint

- story: continue smoke lapse not enough motivation 2
  steps:
  - checkpoint: continue_relapse_dialog_smoke_lapse
  - action: hrs_enough_motivation_form
  - active_loop: hrs_enough_motivation_form
  - slot_was_set:
    - hrs_enough_motivation_slot: 2
  - active_loop: null
  - action: utter_bad_to_hear_1
  - action: utter_bad_to_hear_2
  - action: hrs_activity_form
  - active_loop: hrs_activity_form
  - slot_was_set:
      - hrs_activity_slot: 2
  - active_loop: null
  - action: utter_hrs_call_help
  - action: action_end_dialog


# 3c smoking - Relapse
  - checkpoint: smoke_relapse
  - action: utter_smoke_lapse_1
  - action: type_and_number_smoke_relapse_form
  - active_loop: type_and_number_smoke_relapse_form
  - slot_was_set:
    - requested_slot: number_smoke_relapse  # TODO: store number in DB.
  - slot_was_set:
    - requested_slot: number_smoke_relapse_confirm  # TODO: maybe later substitue number for actual type
  - slot_was_set:
    - requested_slot: type_smoke_relapse
  - slot_was_set:
    - requested_slot: type_smoke_relapse_confirm
  - active_loop: null
  - action: utter_smoke_lapse_5
  - action: utter_smoke_relapse_1
  - action: utter_smoke_relapse_2
  - action: utter_smoke_relapse_3
  - action: utter_smoke_relapse_4  # TODO: Check with kristell that this question indicates it is about today!
  - action: what_doing_how_feel_smoke_form  # Note: reuse the form from the lapse dialog
  - active_loop: what_doing_how_feel_smoke_form
  - slot_was_set:
    - requested_slot: what_doing_smoke  # TODO: store in DB
  - slot_was_set:
    - requested_slot: how_feel_smoke   # TODO: store to DB
  - active_loop: null
  - action: utter_smoke_lapse_11
  - action: with_whom_event_smoke_form
  - active_loop: with_whom_event_smoke_form
  - slot_was_set:
    - requested_slot: with_whom_smoke   # TODO: store to DB
  - slot_was_set:
    - requested_slot: event_smoke  # TODO: store to DB. These parameters can all be stored in one go
  - active_loop: null
  - action: utter_smoke_lapse_12
  - action: utter_smoke_lapse_13
  - action: utter_smoke_lapse_14
  - action: show_barchart_difficult_situations # TODO: Show bar diagram
  - action: reflect_bar_chart_form
  - active_loop: reflect_bar_chart_form
  - slot_was_set:
    - requested_slot: reflect_bar_chart
  - active_loop: null
  - action: utter_smoke_lapse_15
  - action: utter_smoke_lapse_16
  - action: utter_smoke_relapse_5
  - checkpoint: stop_now_or_later_checkpoint

- story: decide to stop now
  steps:
  - checkpoint: stop_now_or_later_checkpoint
  - action: action_reset_one_or_two_slot
  - action: relapse_stop_now_later_form
  - active_loop: relapse_stop_now_later_form
  - slot_was_set:
    - one_or_two_slot: 1
  - active_loop: null
  - action: utter_smoke_relapse_6
  - action: utter_smoke_relapse_7
  - action: utter_smoke_relapse_8
  - checkpoint: relapse_medication_info_checkpoint

- story: decide to stop later
  steps:
  - checkpoint: stop_now_or_later_checkpoint
  - action: action_reset_one_or_two_slot
  - action: relapse_stop_now_later_form
  - active_loop: relapse_stop_now_later_form
  - slot_was_set:
    - one_or_two_slot: 2
  - active_loop: null
  - action: utter_test_utterance # TODO: implement goal setting for new quit date (row 178)
  - checkpoint: relapse_medication_info_checkpoint

- story: decide to get medication info
  steps:
  - checkpoint: relapse_medication_info_checkpoint
  - action: action_reset_one_or_two_slot
  - action: relapse_medication_info_form
  - active_loop: relapse_medication_info_form
  - slot_was_set:
    - one_or_two_slot: 1
  - active_loop: null
  - action: utter_test_utterance # TODO: implement medication dialog (row 186)
  - checkpoint: relapse_ehbo_checkpoint

- story: decide not to get medication info
  steps:
  - checkpoint: relapse_medication_info_checkpoint
  - action: action_reset_one_or_two_slot
  - action: relapse_medication_info_form
  - active_loop: relapse_medication_info_form
  - slot_was_set:
    - one_or_two_slot: 2
  - active_loop: null
  - action: utter_test_utterance2 # TODO: go to form
  - checkpoint: relapse_ehbo_checkpoint

- story: relapse choose ehbo or activity
  steps:
  - checkpoint: relapse_ehbo_checkpoint
  - action: action_reset_one_four_slot
  - action: ehbo_form_one_four_slot
  - active_loop: ehbo_form_one_four_slot
  - slot_was_set:
    - one_four_slot: 1
  - active_loop: null
  - action: action_set_slot_relapse_dialog_relapse
  - checkpoint: open_fak

- story: smoke relapse system suggests activity
  steps:
  - checkpoint: relapse_ehbo_checkpoint
  - action: action_reset_one_four_slot
  - action: ehbo_form_one_four_slot
  - active_loop: ehbo_form_one_four_slot
  - slot_was_set:
    - one_four_slot: 2
  - active_loop: null
  - action: show_first_coping_activity
  - checkpoint: continue_relapse_dialog_smoke_relapse

- story: smoke relapse user chooses activity
  steps:
  - checkpoint: relapse_ehbo_checkpoint
  - action: action_reset_one_four_slot
  - action: ehbo_form_one_four_slot
  - active_loop: ehbo_form_one_four_slot
  - slot_was_set:
    - one_four_slot: 3
  - active_loop: null
  - action: utter_hrs_list_activities_intro
  - action: populate_coping_activities_list
  - action: hrs_choose_coping_activity_form
  - active_loop: hrs_choose_coping_activity_form
  - active_loop: null
  - action: show_chosen_coping_activity
  - checkpoint: continue_relapse_dialog_smoke_relapse

- story: smoke relapse user has motivation
  steps:
  - checkpoint: relapse_ehbo_checkpoint
  - action: action_reset_one_four_slot
  - action: ehbo_form_one_four_slot
  - active_loop: ehbo_form_one_four_slot
  - slot_was_set:
    - one_four_slot: 4
  - active_loop: null
  - action: utter_good_to_hear_1
  - action: utter_good_to_hear_2
  - action: action_end_dialog

- story: continue smoke lapse enough motivation
  steps:
  - checkpoint: continue_relapse_dialog_smoke_relapse
  - action: hrs_enough_motivation_form
  - active_loop: hrs_enough_motivation_form
  - slot_was_set:
    - hrs_enough_motivation_slot: 1
  - active_loop: null
  - action: utter_good_to_hear_1
  - action: utter_good_to_hear_2
  - action: action_end_dialog

- story: continue smoke relapse not enough motivation 1
  steps:
  - checkpoint: continue_relapse_dialog_smoke_relapse
  - action: hrs_enough_motivation_form
  - active_loop: hrs_enough_motivation_form
  - slot_was_set:
    - hrs_enough_motivation_slot: 2
  - active_loop: null
  - action: utter_bad_to_hear_1
  - action: utter_bad_to_hear_2
  - action: hrs_activity_form
  - active_loop: hrs_activity_form
  - slot_was_set:
      - hrs_activity_slot: 1
  - active_loop: null
  - checkpoint: relapse_ehbo_checkpoint

- story: continue smoke relapse not enough motivation 2
  steps:
  - checkpoint: continue_relapse_dialog_smoke_relapse
  - action: hrs_enough_motivation_form
  - active_loop: hrs_enough_motivation_form
  - slot_was_set:
    - hrs_enough_motivation_slot: 2
  - active_loop: null
  - action: utter_bad_to_hear_1
  - action: utter_bad_to_hear_2
  - action: hrs_activity_form
  - active_loop: hrs_activity_form
  - slot_was_set:
      - hrs_activity_slot: 2
  - active_loop: null
  - action: utter_hrs_call_help
  - action: action_end_dialog

## Stories for PA
## 2d/2e (identical) Parent for PA - HRS
- story: pa parent hrs
  steps:
  - checkpoint: pa_parent
  - action: utter_pa_define_1  # Ask Kristell if this is needed.
  - action: utter_pa_lapse_1
  - action: utter_pa_lapse_2
  - action: utter_pa_lapse_3
  - action: pa_type_together_why_fail_form
  - active_loop: pa_type_together_why_fail_form
  - slot_was_set:
    - requested_slot: pa_type   # TODO: store to DB
  - slot_was_set:
    - requested_slot: pa_together
  - slot_was_set:
    - requested_slot: pa_why_fail  # TODO: if answer is 7 ask Kristell
  - active_loop: null
  - action: utter_pa_lapse_4
