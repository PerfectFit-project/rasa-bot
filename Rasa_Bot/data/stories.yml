version: "3.0"

stories:

- story: request_plan_week_calendarYes
  steps:
  - intent: request_plan_week
  - action: action_get_age_from_database
  - action: action_get_plan_week
  - action: utter_plan_week
  - action: utter_ask_plan_calendar
  - intent: confirm
  - action: action_save_plan_week_calendar
  - slot_was_set:
    - success_save_calendar_plan_week: True
  - action: utter_plan_calendar_confirmation
  
# saving in calendar failed
- story: request_plan_week_calendarYes_Error
  steps:
  - intent: request_plan_week
  - action: action_get_age_from_database
  - action: action_get_plan_week
  - action: utter_plan_week
  - action: utter_ask_plan_calendar
  - intent: confirm
  - action: action_save_plan_week_calendar
  - slot_was_set:
    - success_save_calendar_plan_week: False
  - action: utter_error_save_plan_week_calendar
  
# User does not want to save plan in calendar
- story: request_plan_week_calendarNo
  steps:
  - intent: request_plan_week
  - action: action_get_age_from_database
  - action: action_get_plan_week
  - action: utter_plan_week
  - action: utter_ask_plan_calendar
  - intent: deny
  - action: utter_okay
      
# User asks agent how he/she is doing, and agent asks back
- story: user_asks_agent_mood
  steps:
  - intent: how_are_you
  - action: utter_agent_mood
  - action: utter_ask_back
  - checkpoint: user_mood_response
  
# when user says hello, we say hello back and ask about the user's mood
- story: user_hello
  steps:
  - intent: greeting
  - action: action_get_name_from_database
  - action: utter_greet
  - action: utter_ask_user_mood
  - checkpoint: user_mood_response

# user has a positive mood
- story: user_positive_mood
  steps:
  - checkpoint: user_mood_response
  - intent: positive_mood
  - action: utter_response_mood_positive

# user has a negative mood
- story: user_negative_mood
  steps:
  - checkpoint: user_mood_response
  - intent: negative_mood
  - action: utter_response_mood_negative

# User indicates completion PA
- story: user_indicate_pa
  steps:
  - intent: completed_pa
  - action: utter_pa_completed
  - action: pa_evaluation_form
  - active_loop: pa_evaluation_form
  - action: action_store_pa_evaluation
  - slot_was_set: 
    - pa_evaluation_response: null
  - action: action_utter_pa_evaluation_form_filled


# User foresees HRS
- story: user_foresees_hrs
  steps:
    - intent: EXTERNAL_trigger_ask_foreseen_hrs
    - action: utter_ask_foreseen_hrs
    - intent: confirm
    - action: utter_watering_plants

# User does not foresee HRS
- story: user_does_not_foresee_hrs
  steps:
    - intent: EXTERNAL_trigger_ask_foreseen_hrs
    - action: utter_ask_foreseen_hrs
    - intent: deny
    - action: utter_be_careful_for_hrs
    
    
# Rescheduling query - now
- story: rescheduling query dialog now
  steps:
    - checkpoint: rescheduling_query_dialog
    - action: rescheduling_now_or_later_form
    - active_loop: rescheduling_now_or_later_form
    - slot_was_set: 
      - rescheduling_now: true
    - active_loop: null
    - action: utter_user_chose_now
    - action: action_reset_rescheduling_now_slot
    - slot_was_set:
      - rescheduling_now: null
    - checkpoint: continue_with_future_self_dialog_after_rescheduling_query

    
# Rescheduling query - later
- story: rescheduling query dialog later
  steps:
    - checkpoint: rescheduling_query_dialog
    - action: rescheduling_now_or_later_form
    - active_loop: rescheduling_now_or_later_form
    - slot_was_set: 
      - rescheduling_now: false
    - active_loop: null
    - action: utter_user_chose_later
    - action: action_reset_rescheduling_now_slot
    - slot_was_set:
      - rescheduling_now: null
    - action: action_get_rescheduling_options_list
    - action: rescheduling_options_form
    - active_loop: rescheduling_options_form  # TODO: use rescheduling_option slot to reschedule
    - active_loop: null
    - action: utter_rescheduling_option_chosen
    - action: action_reset_rescheduling_option_slot
    - slot_was_set:
      - rescheduling_option: null
    # TODO: what are we going to do at the end of the dialog if the user types something again?
    # Maybe a ConversationPaused() event from custom action?
   
    
# Future-self dialog
- story: future-self dialog introduction
  steps:
    - intent: request_future_self_dialog # TODO: Replace with external trigger
    - action: action_get_name_from_database
    - action: utter_greet
    - action: utter_future_self_intro
    - action: action_get_future_self_repetition_from_database
    - action: utter_future_self_intro_exercise_name
    - action: utter_future_self_duration 
    - action: utter_future_self_duration_do_at_once
    - checkpoint: rescheduling_query_dialog
    
- story: continue with future self dialog after rescheduling query
  steps:
    - checkpoint: continue_with_future_self_dialog_after_rescheduling_query
    - action: utter_future_self_explanation
    - checkpoint: ask_smoking_words_list

- story: future-self ask smoking words list
  steps:
    - checkpoint: ask_smoking_words_list
    - action: utter_current_smoker
    - action: utter_smoking_word_list
    - action: pick_smoker_words_form
    - active_loop: pick_smoker_words_form
    - active_loop: null
    - action: utter_picked_smoker_words
    - checkpoint: check_picked_smoker_words

- story: handle confirm picked smoker words
  steps:
    - checkpoint: check_picked_smoker_words
    - action: confirm_words_form
    - active_loop: confirm_words_form
    - slot_was_set:
      - confirm_words_response: true
    - active_loop: null
    - action: action_store_smoker_words
    - action: action_reset_picked_words_slot
    - slot_was_set:
        - picked_words: null
    - action: utter_back_channel_good
    - action: why_picked_smoker_words_form
    - active_loop: why_picked_smoker_words_form
    - active_loop: null
    - action: utter_why_picked_words_response
    - action: action_reset_confirm_words_response_slot_smoking
    - slot_was_set:
      - confirm_words_response: null
    - action: action_store_why_smoker_words
    - action: action_reset_why_picked_words_slot_smoking
    - slot_was_set:
      - why_picked_words: null
    - action: utter_intro_current_mover
    - checkpoint: finished_check_picked_smoker_words

- story: handle deny picked smoker words
  steps:
    - checkpoint: check_picked_smoker_words
    - action: confirm_words_form
    - active_loop: confirm_words_form
    - slot_was_set:
      - confirm_words_response: false
    - active_loop: null
    - action: action_reset_picked_words_slot
    - slot_was_set:
      - picked_words: null
    - action: action_reset_confirm_words_response_slot_smoking
    - slot_was_set:
      - confirm_words_response: null
    - checkpoint: ask_smoking_words_list

- story: future-self ask moving words list
  steps:
    - checkpoint: finished_check_picked_smoker_words
    - action: utter_current_mover
    - action: utter_moving_word_list
    - action: pick_mover_words_form
    - active_loop: pick_mover_words_form
    - active_loop: null
    - action: utter_picked_mover_words
    - checkpoint: check_picked_mover_words

- story: handle confirm picked mover words
  steps:
    - checkpoint: check_picked_mover_words
    - action: confirm_words_form
    - active_loop: confirm_words_form
    - slot_was_set:
      - confirm_words_response: true
    - active_loop: null
    - action: action_store_mover_words
    - action: action_reset_picked_words_slot
    - slot_was_set:
      - picked_words: null
    - action: utter_back_channel_good
    - action: why_picked_mover_words_form
    - active_loop: why_picked_mover_words_form
    - active_loop: null
    - action: utter_why_picked_words_response
    - action: action_reset_confirm_words_response_slot_pa
    - slot_was_set:
      - confirm_words_response: null
    - action: action_store_why_mover_words
    - action: action_reset_why_picked_words_slot_pa
    - slot_was_set:
      - why_picked_words: null
    - action: utter_self_view_intro
    - checkpoint: finished_check_picked_mover_words

- story: handle deny picked mover words
  steps:
    - checkpoint: check_picked_mover_words
    - action: confirm_words_form
    - active_loop: confirm_words_form
    - slot_was_set:
      - confirm_words_response: false
    - active_loop: null
    - action: utter_try_again
    - action: action_reset_picked_words_slot
    - slot_was_set:
      - picked_words: null
    - action: action_reset_confirm_words_response_slot_pa
    - slot_was_set:
      - confirm_words_response: null
    - checkpoint: finished_check_picked_smoker_words

- story: I see myself as smoker words
  steps:
    - checkpoint: finished_check_picked_mover_words
    - action: utter_see_myself_as_smoker_options
    - action: see_myself_as_smoker_form
    - active_loop: see_myself_as_smoker_form
    - active_loop: null
    - action: utter_see_myself_as_picked_smoker_words
    - action: action_map_see_myself_as_picked_words_smoker
    - checkpoint: check_I_see_myself_as_smoker_words
    
- story: Confirm check I see myself as smoker words
  steps:
    - checkpoint: check_I_see_myself_as_smoker_words
    - action: confirm_words_form
    - active_loop: confirm_words_form
    - slot_was_set:
      - confirm_words_response: true
    - active_loop: null
    - action: action_store_see_myself_as_picked_smoker_words
    - action: utter_leuk
    - action: action_reset_see_myself_as_picked_words_smoker
    - slot_was_set:
      - see_myself_as_picked_words_smoker: null
    - action: action_reset_confirm_words_response_slot_smoking
    - slot_was_set:
      - confirm_words_response: null
    - checkpoint: finished_I_see_myself_as_smoker_words

- story: Deny check I see myself as smoker words
  steps:
    - checkpoint: check_I_see_myself_as_smoker_words
    - action: confirm_words_form
    - active_loop: confirm_words_form
    - slot_was_set:
      - confirm_words_response: false
    - active_loop: null
    - action: utter_try_again
    - action: action_reset_see_myself_as_picked_words_smoker
    - slot_was_set:
      - see_myself_as_picked_words_smoker: null
    - action: action_reset_confirm_words_response_slot_smoking
    - slot_was_set:
      - confirm_words_response: null
    - checkpoint: finished_check_picked_mover_words
    
- story: I see myself as mover words
  steps:
    - checkpoint: finished_I_see_myself_as_smoker_words
    - action: utter_see_myself_as_mover_options
    - action: see_myself_as_mover_form
    - active_loop: see_myself_as_mover_form
    - active_loop: null
    - action: utter_see_myself_as_picked_mover_words
    - action: action_map_see_myself_as_picked_words_mover
    - checkpoint: check_I_see_myself_as_mover_words
    
- story: Confirm check I see myself as mover words
  steps:
    - checkpoint: check_I_see_myself_as_mover_words
    - action: confirm_words_form
    - active_loop: confirm_words_form
    - slot_was_set:
      - confirm_words_response: true
    - active_loop: null
    - action: action_store_see_myself_as_picked_mover_words
    - action: utter_fijn
    - action: action_reset_see_myself_as_picked_words_mover
    - slot_was_set:
      - see_myself_as_picked_words_mover: null
    - action: action_reset_confirm_words_response_slot_pa
    - slot_was_set:
      - confirm_words_response: null
    - checkpoint: finished_I_see_myself_as_mover_words

- story: Deny check I see myself as mover words
  steps:
    - checkpoint: check_I_see_myself_as_mover_words
    - action: confirm_words_form
    - active_loop: confirm_words_form
    - slot_was_set:
      - confirm_words_response: false
    - active_loop: null
    - action: utter_try_again_see_myself_mover
    - action: action_reset_see_myself_as_picked_words_mover
    - slot_was_set:
      - see_myself_as_picked_words_mover: null
    - action: action_reset_confirm_words_response_slot_pa
    - slot_was_set:
      - confirm_words_response: null
    - checkpoint: finished_I_see_myself_as_smoker_words

- story: I see myself as why
  steps:
    - checkpoint: finished_I_see_myself_as_mover_words
    - action: why_see_myself_as_smoker_form
    - active_loop: why_see_myself_as_smoker_form
    - active_loop: null  # TODO: store slot in database
    - action: action_reset_why_picked_words_slot_smoking
    - slot_was_set:
      - why_picked_words: null
    - action: why_see_myself_as_mover_form
    - active_loop: why_see_myself_as_mover_form
    - active_loop: null  # TODO: store slot in database
    - action: action_reset_why_picked_words_slot_pa
    - slot_was_set:
      - why_picked_words: null
    - action: action_set_future_self_dialog_state_step_1
    - action: action_store_future_self_dialog_state
    - action: utter_close_future_self_step_1
    

## Get first aid kit - kit exists
- story: Get first aid kit exists
  steps:
    - intent: get_first_aid_kit
    - action: action_get_first_aid_kit
    - slot_was_set:
      - first_aid_kit_exists: true
    - action: utter_first_aid_kit
    
    
## Get first aid kit - kit does not exist yet
- story: Get first aid kit does not exist
  steps:
    - intent: get_first_aid_kit
    - action: action_get_first_aid_kit
    - slot_was_set:
      - first_aid_kit_exists: false
    - action: utter_first_aid_kit_empty

###Preparation Phase stories

 ## Profile Creation
- story: Profile Creation placeholder
  steps:
    - intent: EXTERNAL_trigger_profile_creation
    - action: action_slot_profile_creation
    - action: utter_ask_profile_info 
    - action: action_store_intervention_component

## Medication Talk
- story: Medication Talk placeholder
  steps:
   - intent: EXTERNAL_trigger_medication_talk
   - action: action_slot_medication_talk
   - action: utter_medication_talk
#   - action: action_save_medication_talk

## Cold Turkey
- story: Cold Turkey placeholder
  steps:
  - intent: EXTERNAL_trigger_cold_turkey
  - action: action_slot_cold_turkey
  - action: utter_cold_turkey
# - action: action_save_cold_turkey

## Plan Quit & Start Date
- story: Plan Quit & Start Date placeholder
  steps:
   - intent: EXTERNAL_trigger_plan_quit_start
   - action: action_slot_plan_quit_start
   - action: utter_plan_quit_start
#   - action: action_save_plan_quit_start

## Mental-contrasting
- story: Mental-contrasting placeholder
  steps:
  - intent: EXTERNAL_trigger_mental_contrasting
  - action: action_slot_mental_contrasting
  - action: utter_mental_contrasting
#   - action: action_save_mental_contrasting

## Goal-setting
- story: Goal-setting placeholder
  steps:
  - intent: EXTERNAL_trigger_goal_setting
  - action: action_slot_goal_setting
  - action: utter_goal_setting
#   - action: action_save_goal_setting





