version: "2.0"

stories:

- story: request_plan_week_calendarYes
  steps:
  - intent: request_plan_week
  - action: action_get_sender_id_from_tracker
  - action: action_get_age_from_database
  - action: action_get_plan_week
  - action: utter_plan_week
  - action: utter_ask_plan_calendar
  - intent: confirm
  - action: action_save_plan_week_calendar
  - slot_was_set:
    - success_save_calendar_plan_week: True
  - action: utter_plan_calendar_confirmation
  
# saving in calendar failed
- story: request_plan_week_calendarYes_Error
  steps:
  - intent: request_plan_week
  - action: action_get_sender_id_from_tracker
  - action: action_get_age_from_database
  - action: action_get_plan_week
  - action: utter_plan_week
  - action: utter_ask_plan_calendar
  - intent: confirm
  - action: action_save_plan_week_calendar
  - slot_was_set:
    - success_save_calendar_plan_week: False
  - action: utter_error_save_plan_week_calendar
  
# User does not want to save plan in calendar
- story: request_plan_week_calendarNo
  steps:
  - intent: request_plan_week
  - action: action_get_sender_id_from_tracker
  - action: action_get_age_from_database
  - action: action_get_plan_week
  - action: utter_plan_week
  - action: utter_ask_plan_calendar
  - intent: deny
  - action: utter_okay
      
# User asks agent how he/she is doing, and agent asks back
- story: user_asks_agent_mood
  steps:
  - intent: how_are_you
  - action: utter_agent_mood
  - action: utter_ask_back
  - checkpoint: user_mood_response
  
# when user says hello, we say hello back and ask about the user's mood
- story: user_hello
  steps:
  - intent: greeting
  - action: action_get_sender_id_from_tracker
  - action: action_get_name_from_database
  - action: utter_greet
  - action: utter_ask_user_mood
  - checkpoint: user_mood_response

# user has a positive mood
- story: user_positive_mood
  steps:
  - checkpoint: user_mood_response
  - intent: positive_mood
  - action: utter_response_mood_positive

# user has a negative mood
- story: user_negative_mood
  steps:
  - checkpoint: user_mood_response
  - intent: negative_mood
  - action: utter_response_mood_negative

# User indicates completion PA
- story: user_indicate_pa
  steps:
  - intent: completed_pa
  - action: utter_pa_completed
  - action: pa_evaluation_form
  - active_loop: pa_evaluation_form
  - action: action_get_sender_id_from_tracker
  - action: action_store_pa_evaluation
  - action: action_utter_pa_evaluation_form_filled


# User foresees HRS
- story: user_foresees_hrs
  steps:
    - intent: EXTERNAL_trigger_ask_foreseen_hrs
    - action: utter_ask_foreseen_hrs
    - intent: confirm
    - action: utter_watering_plants

# User does not foresee HRS
- story: user_does_not_foresee_hrs
  steps:
    - intent: EXTERNAL_trigger_ask_foreseen_hrs
    - action: utter_ask_foreseen_hrs
    - intent: deny
    - action: utter_be_careful_for_hrs

# Future-self dialog
- story: future_self_dialog
  steps:
    - intent: request_future_self_dialog # TODO: Replace with external trigger
    - action: utter_greet
    - action: utter_future_self_intro # TODO: Add repetition of activity yes/no
    - action: utter_future_self_duration # TODO: Add rescheduling query
    - action: utter_future_self_explanation
    - action: utter_current_smoker
    - action: utter_smoking_word_list # TODO: In case of repetition retrieve last chosen words
    - action: pick_words_form
    - active_loop: pick_words_form
    - active_loop: null # TODO: store slot in database
    - action: utter_picked_words
    - intent: confirm
    - action: why_picked_words_form
    - active_loop: why_picked_words_form
    - active_loop: null  # TODO: store slot in database
    - action: utter_why_picked_words_response