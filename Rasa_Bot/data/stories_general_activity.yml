## Activities dialog stories
# Purpose: Reflecting previous (=last) activity that the user has done
# and picking the next activity.
# The story flow from the excel sheet is confusing.
# And the flow diagram that came with it is a total mismatch
# Instead check the general_activity_dialog.graphml file
version: "3.1"

# the numbers in the story refer to lines in the database

## 1a: Trigger general activity dialog

stories:
- story: introduction PF
  steps:
  - intent: review_last_activity
  - action: utter_greeting #4
  - action: activity_usefulness_form
  - active_loop: activity_usefulness_form
  - active_loop: null
  - action: general_activity_check_rating
  - checkpoint: low_or_high_rating

## 2a: The rating of the activity is in the top 5

- story: if rating high then check if this activity requires text input
  steps:
  - checkpoint: low_or_high_rating
  - slot_was_set:
    - general_activity_low_high_rating: high #10 it's high
  - action: utter_general_activity_thanks_top_5_1
  - action: check_user_input_required
  - checkpoint: input_required_check

## 3b: The input of the user is not required

- story: if input is not required
  steps:
  - checkpoint: input_required_check
  - slot_was_set:
    - is_user_input_required: false
  - action: utter_general_activity_look_back
  - action: store_activity_to_fak

## 3c: The input of the user is required and already given

- story: if input is required and previously given
  steps:
  - checkpoint: input_required_check
  - slot_was_set:
    - is_user_input_required: true
  - action: check_activity_done
  - checkpoint: has_activity_already_done

## 3c: the activity has been already done before

- story: if input is required and previously given
  steps:
  - checkpoint: has_activity_already_done
  - slot_was_set:
    - is_activity_done: true
  - action: get_activity_user_input
  - action: utter_general_activity_thanks_top_5_2
  - action: save_or_edit_form
  - active_loop: save_or_edit_form
  - active_loop: null
  - checkpoint: save_or_edit_checkpoint

## 4b: save option selected

- story: if the user decides to save the previous content
  steps:
  - checkpoint: save_or_edit_checkpoint
  - slot_was_set:
    - save_or_edit_slot: 1
  - action: utter_general_activity_save

## 4a: edit option selected

- story: if the user decides to edit the previous content
  steps:
  - checkpoint: save_or_edit_checkpoint
  - slot_was_set:
    - save_or_edit_slot: 2
  - action: utter_general_activity_edit_1
  - checkpoint: input_activity_description

## 4a: input the description

- story: if the user decides to edit the previous content
  steps:
  - checkpoint: input_activity_description
  - action: utter_general_activity_edit_2
  - action: general_activity_description_form
  - active_loop: general_activity_description_form
  - active_loop: null
  - action: save_description_in_db
  - action: utter_general_activity_edit_3

## 2b: The rating of the activity is not in the top 5
  
- story: if rating is low then just thanks
  steps:
  - checkpoint: low_or_high_rating
  - slot_was_set:
    - general_activity_low_high_rating: low
  - action: utter_general_activity_thanks #9
  - checkpoint: choose_activity_checkpoint

## 6a: the user choose the activity

- story: new activities are randomly proposed to the user
  steps:
  - checkpoint: choose_activity_checkpoint
  - activity: get_three_random_activities
  - action: general_activity_next_activity_form
  - active_loop: general_activity_next_activity_form
  - active_loop: null
  - checkpoint: user_activity_choice_checkpoint

## 6a: the user asks another set of activities

- story: user asks another set of activities
  steps:
  - checkpoint: user_activity_choice_checkpoint
  - slot_was_set:
      - general_activity_next_activity_slot: 4
  - checkpoint: choose_activity_checkpoint
    