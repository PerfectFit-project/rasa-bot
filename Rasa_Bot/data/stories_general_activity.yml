## Activities dialog stories
# Purpose: Reflecting previous (=last) activity that the user has done
# and picking the next activity.
# The story flow from the excel sheet is confusing.
# And the flow diagram that came with it is a total mismatch
# Instead check the general_activity_dialog.graphml file
version: "3.1"

# the numbers in the story refer to lines in the database

## 1a: Trigger general activity dialog

stories:
- story: introduction PF
  steps:
  - intent: review_last_activity
  - action: utter_greeting #4
  - action: activity_usefulness_form
  - active_loop: activity_usefulness_form
  - active_loop: null
  - action: general_activity_check_rating
  - checkpoint: low_or_high_rating

## 2a: The rating of the activity is in the top 5

- story: if rating high then check if this activity requires text input
  steps:
  - checkpoint: low_or_high_rating
  - slot_was_set:
    - general_activity_low_high_rating: high #10 it's high
  - action: utter_general_activity_thanks_top_5_1
  - action: check_user_input_required
  - checkpoint: input_required_check

## 3b: The input of the user is not required

- story: if input is not required
  steps:
  - checkpoint: input_required_check
  - slot_was_set:
    - is_user_input_required: false
  - action: utter_general_activity_look_back
  - action: store_activity_to_fak

## 3c: The input of the user is required and already given

- story: if input is required and previously given
  steps:
  - checkpoint: input_required_check
  - slot_was_set:
    - is_user_input_required: true
  - action: check_activity_done
  - checkpoint: has_activity_already_done

## 3c: the activity has been already done before

- story: if input is required and previously given
  steps:
  - checkpoint: has_activity_already_done
  - slot_was_set:
    - is_activity_done: true
  - action: get_activity_user_input
  - action: utter_general_activity_thanks_top_5_2
  - action: save_or_edit_form
  - active_loop: save_or_edit_form
  - active_loop: null
  - checkpoint: save_or_edit_checkpoint

## 4b: save option selected

- story: if the user decides to save the previous content
  steps:
  - checkpoint: save_or_edit_checkpoint
  - slot_was_set:
    - save_or_edit_slot: 1
  - action: utter_general_activity_save

## 4a: edit option selected

- story: if the user decides to edit the previous content
  steps:
  - checkpoint: save_or_edit_checkpoint
  - slot_was_set:
    - save_or_edit_slot: 2
  - action: utter_general_activity_edit_1
  - checkpoint: input_activity_description

## 4a: input the description

- story: if the user decides to edit the previous content
  steps:
  - checkpoint: input_activity_description
  - action: utter_general_activity_edit_2
  - action: general_activity_description_form
  - active_loop: general_activity_description_form
  - active_loop: null
  - action: save_description_in_db
  - action: utter_general_activity_edit_3

## 2b: The rating of the activity is not in the top 5
  
- story: if rating is low then just thanks
  steps:
  - checkpoint: low_or_high_rating
  - slot_was_set:
    - general_activity_low_high_rating: low
  - action: utter_general_activity_thanks #9
 # - checkpoint: CHOOSE_ACTIVITY_STORY

#- story: user needs to enter text. But is there already text?
#  steps:
#  - checkpoint: what_we_learned_ask_text_or_not
#  - slot_was_set:
#    - action_requires_user_text: true #11
#  - action: get_previously_learned
#  - checkpoint: add_or_edit_what_was_learned
#
#- story:
#  - checkpoint: add_or_edit_what_was_learned
#  steps:
#  - slot_was_set:
#    - previously_learned: None #12
#  - action: utter_thanks_feedback_added
#  - action: utter_what_you_learned_from_activity
#  - action: learned_from_activity_form
#  - active_loop: learned_from_activity_form #14
#  - slot_was_set:
#    - learned_from_activity
#  - active_loop: null
#  - # FIXME what to do with #16? It does not lead to any new action
#  - action: utter_learned_from_activity_thanks  #19
#  - action: store_learned_from_activity
#  - checkpoint: CHOOSE_ACTIVITY_STORY
#
#- story:
#  - checkpoint: add_or_edit_what_was_learned
#  steps:
#  - slot_was_set:
#    - previously_learned: anytext #20
#  - action: utter_thanks_learned_from_activity_modification
#  - action: change_learned_from_activity_form
#  - active_loop: change_learned_from_activity_form #14
#  - slot_was_set:
#    - change_learned_from_activity
#  - active_loop: null
#  - checkpoint: check_change_learned_from_activity
#
#- story: user wants to change his 'learned from' text
#  steps:
#  - checkpoint: check_change_learned_from_activity
#  - slot_was_set:
#    - change_learned_from_activity: true #23
#  - action: utter_ask_learned_from_activity_changed #24
#  # FIXME we just ask for new text, dont know how to show old text.
#  - active_loop: learned_from_activity_form #14
#  - slot_was_set:
#    - learned_from_activity
#  - active_loop: null
#  - action: utter_thanks_learned_from_activity_modification #29
#  - action: store_learned_from_activity
#  - checkpoint: CHOOSE_ACTIVITY_STORY
#
#
#- story: user does not want to change his 'learned from' text.
#  steps:
#  - checkpoint: check_change_learned_from_activity
#  - slot_was_set:
#    - change_learned_from_activity: false #23
#  - checkpoint: CHOOSE_ACTIVITY_STORY
#
#- story: this action  takes the "original resource text" as "what was learned"
#  steps:
#  - checkpoint: what_we_learned_ask_text_or_not
#  - slot_was_set:
#    action_requires_user_text: false #28 no special text needed
#  # FIXME store "original resource text" in first-aid kit
#  # I have no clue what this text is . Probably need to call an action
#  # no user input
#  - checkpoint: CHOOSE_ACTIVITY_STORY
#
#
#
###############################################
##30
#Here all above dialogs converge to for step 2
#
#- story: choose the next activity #30
#  steps:
#  - checkpoint: CHOOSE_ACTIVITY_STORY
#  - action: get_activity
#  - checkpoint: determine_next_activity
#  # finished this, back to the root
#
#
#- story: user chooses next activity
#  steps:
#  - checkpoint: determine_next_activity
#  - slot_was_set:
#    - activity1: None #31
#  - action: pick_3_activities
#  - action: next_activity_form
#  - active_loop: next_activity_form
#  - slot_was_set:
#    - next_activity
#  - active_loop: null
#  #32 FIXME "Next time the user is in this dialogue again, the activity that gets chosen here (so the one the user completes) gets inserted at line 7. The activity only needs to be saved once to be inserted at line 7, after that it can be overwritten by the newly completed activity. "?
#  - checkpoint: check_chosen_action
#
#- story:  user chose activity 1
#  steps:
#  - checkpoint: check_chosen_action
#  - slot_was_set:
#    - next_activity: 1 #31
#  - action: set_next_activity
#  #this finishes the stories
#
#- story:  user chose activity 2
#  steps:
#  - checkpoint: check_chosen_action
#  - slot_was_set:
#    - next_activity: 2 #31
#  - action: set_next_activity
#  #this finishes the stories
#
#- story:  user chose activity 3
#  steps:
#  - checkpoint: check_chosen_action
#  - slot_was_set:
#    - next_activity: 3 #31
#  - action: set_next_activity
#  #this finishes the stories
#
#- story: user chose 'another activity' (option  4)
#  steps:
#  - checkpoint: check_chosen_action
#  - slot_was_set:
#    - next_activity: 3 #31
#  - checkpoint: determine_next_activity # loop back to picking 3
#
#- story: we have obligatory next activity (which is activity1_name)
#  steps:
#  - checkpoint: determine_next_activity
#  - slot_was_set:
#    - activity1: someactivity #35
#  - slot{"next_activity",1} # activity1_name was set by get_activity
#  - action: utter_tell_next_activity
#  - action: set_next_activity
  #this finishes the stories
  
   
    
    

    
    
    
    
    
    
    
    
    