# Rules for the goal setting dialog
version: "3.1"

rules:


## 1 Introduce goal setting dialog
- rule: introduce goal setting dialog
  steps:
  - intent: goal_setting_dialog  # for testing
  - action: action_set_slot_goal_setting_dialog
  - action: utter_goal_setting_greeting
  - action: how_doing_form
  - active_loop: how_doing_form
  wait_for_user_input: false

## 1 + 2: introduce goal setting and ask for extra explanation
- rule: ask if explanation is needed
  condition:
  - active_loop: how_doing_form
  steps:
  - action: how_doing_form
  - active_loop: null
  - slot_was_set:
    - how_doing_slot: null
  - action: utter_thanks_for_sharing
  - action: utter_goal_setting_1
  - action: utter_goal_setting_2
  - action: utter_goal_setting_3
  - action: utter_goal_setting_4
  - action: utter_goal_setting_smoke_1
  - action: utter_goal_setting_smoke_2
  - action: utter_goal_setting_smoke_3
  - action: extra_explanation_form
  - active_loop: extra_explanation_form
  wait_for_user_input: false

## 2a1: Explanation cold turkey
- rule: extra explanation on cold turkey triggered
  condition:
  - active_loop: extra_explanation_form
  steps:
  - action: extra_explanation_form
  - active_loop: null
  - slot_was_set:
    - extra_explanation_quiting: 1
  - action: utter_goal_setting_extra_explanation_1
  - action: utter_goal_setting_extra_explanation_2
  - action: action_launch_goal_setting

## 2b: Explanation cold turkey
- rule: extra explanation on cold turkey triggered
  condition:
  - active_loop: extra_explanation_form
  steps:
  - action: extra_explanation_form
  - active_loop: null
  - slot_was_set:
    - extra_explanation_quiting: 2
  - action: action_launch_goal_setting


## 2b: set new quit date
- rule: Ask a new quit date
  steps:
  - action: action_get_first_last_date
  - action: utter_goal_setting_choose_date_1
  - action: utter_goal_setting_choose_date_2
  - action: utter_goal_setting_choose_date_3
  - action: chosen_quit_date_form
  - active_loop: chosen_quit_date_form
  wait_for_user_input: false

- rule: Write plan
  condition:
  - active_loop: chosen_quit_date_form
  steps:
  - action: chosen_quit_date_form  # TODO: store date to db
  - active_loop: null
  - action: utter_goal_setting_choose_date_4
  - action: utter_goal_setting_choose_date_5
  - action: utter_goal_setting_choose_date_6
  - action: utter_goal_setting_choose_date_7
  - action: utter_goal_setting_choose_date_8
  - action: utter_goal_setting_choose_date_9
  - action: utter_goal_setting_choose_date_10
  - action: goal_setting_plan_finished_form
  - active_loop: goal_setting_plan_finished_form
  - active_loop: null
  - action: utter_goal_setting_choose_date_11
  - action: utter_goal_setting_choose_date_12
  - action: utter_goal_setting_choose_date_13
  - action: action_goal_setting_continue_after_plan

- rule: explanation goal setting pa
  steps:
  - action: utter_goal_setting_pa_expl_1
  - action: utter_goal_setting_pa_expl_2
  - action: utter_goal_setting_pa_expl_3
  - action: utter_goal_setting_pa_expl_4
  - action: utter_goal_setting_pa_expl_5  # TODO: show image with levels of PA intensity
  - action: utter_goal_setting_pa_expl_6
  - action: utter_goal_setting_pa_expl_7
  - action: utter_goal_setting_pa_expl_8
  - action: utter_goal_setting_pa_expl_9
  - action: utter_goal_setting_pa_expl_10
  - action: utter_goal_setting_pa_expl_11  # TODO: extract number of steps from DB
  - action: utter_goal_setting_pa_set_1
  - action: utter_goal_setting_pa_set_2
  - action: utter_goal_setting_pa_set_3
  - action: utter_goal_setting_pa_set_4
  - action: which_sport_form
  - active_loop: which_sport_form
  - active_loop: null  # TODO: store slot to database
  - action: utter_goal_setting_pa_set_5
  - action: utter_goal_setting_pa_set_6
  - action: first_pa_goal_form
  - active_loop: first_pa_goal_form
  - active_loop: null  # TODO: ask if this is needed in database
  - action: utter_goal_setting_pa_set_7
  - action: utter_goal_setting_pa_set_8
  - action: utter_goal_setting_pa_set_9
  - action: testimonial_one_read_form
  - active_loop: testimonial_one_read_form
  - active_loop: null
  - action: read_second_testimonial_form
  - active_loop: read_second_testimonial_form
  wait_for_user_input: false

# 3b1 read second testimonial pa
- rule: read second testimonial pa
  condition:
  - active_loop: read_second_testimonial_form
  steps:
  - action: read_second_testimonial_form
  - active_loop: null
  - slot_was_set:
    - read_second_testimonial: 1
  - action: utter_second_testimonial_1
  - action: utter_second_testimonial_2
  - action: testimonial_two_read_form
  - active_loop: testimonial_two_read_form
  - active_loop: null
  - action: action_continue_testimonial_evaluation

- rule: skip second testimonial pa
  condition:
  - active_loop: read_second_testimonial_form
  steps:
  - action: read_second_testimonial_form
  - active_loop: null
  - slot_was_set:
    - read_second_testimonial: 2
  - action: action_continue_testimonial_evaluation

- rule: evaluate testimonials
  steps:
  - action: utter_test_utter_1
